<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Respuesta Progresiva</title>
<style>
  #respuesta{
    white-space: pre-wrap;
    font-family: monospace;
    font-size: 1.2rem;
  }
</style>
</head>
<body>
<pre id="respuesta"></pre>

<script>

    const consulta= `
    Durante la Primera Revolución Industrial, hubo una migración masiva de campesinos hacia las ciudades, donde encontraban oportunidad de subsistir como trabajadores asalariados en las nuevas fábricas. Como consecuencia de estos cambios, se definió un nuevo tipo de sociedad, caracterizado por la oposición entre la burguesía (clase social dueña de las fábricas y el capital) y el proletariado (clase social que depende del trabajo asalariado para su subsistencia). 

La Segunda Revolución Industrial se caracterizó por el aumento de la productividad industrial a partir de la introducción de la cadena de montaje (separación del proceso productivo en diferentes etapas) y  nuevas fuentes de energía. En esta segunda etapa, Alemania protagonizó el mayor crecimiento económico, y las transformaciones se extendieron a Estados Unidos y Japón.



    `
  // Función para cargar la respuesta progresivamente. 
  async function cargarRespuesta() {
    const responseContainer = document.getElementById('respuesta');

    // Hacer la solicitud al servidor
    console.log('Haciendo la solicitud al servidor');
    const response = await fetch('http://localhost:3000/api/generateResumen', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({consulta: consulta})
    });

    // Leer los datos progresivamente y actualizar el contenido

    const reader = response.body.getReader();
    let decoder = new TextDecoder();
    let chunk = await reader.read();
    while (!chunk.done) {
      const texto = decoder.decode(chunk.value, { stream: true });
      responseContainer.textContent += texto;
      console.log(texto);
      chunk = await reader.read();
    }
  }

  // Llamar a la función para cargar la respuesta progresivamente
  cargarRespuesta();
</script>
</body>
</html>
